<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ettore Miglioranza">

<title>Data Engineering Manual</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="DE_Manual_files/libs/clipboard/clipboard.min.js"></script>
<script src="DE_Manual_files/libs/quarto-html/quarto.js"></script>
<script src="DE_Manual_files/libs/quarto-html/popper.min.js"></script>
<script src="DE_Manual_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DE_Manual_files/libs/quarto-html/anchor.min.js"></script>
<link href="DE_Manual_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DE_Manual_files/libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DE_Manual_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DE_Manual_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DE_Manual_files/libs/bootstrap/bootstrap-8376ee84cb8298a0560393d3b353343d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#object-storage" id="toc-object-storage" class="nav-link active" data-scroll-target="#object-storage"><span class="header-section-number">1</span> Object Storage</a>
  <ul class="collapse">
  <li><a href="#what-is-object-storage" id="toc-what-is-object-storage" class="nav-link" data-scroll-target="#what-is-object-storage"><span class="header-section-number">1.1</span> What is Object Storage?</a></li>
  <li><a href="#evaluation-of-object-cloud-storage" id="toc-evaluation-of-object-cloud-storage" class="nav-link" data-scroll-target="#evaluation-of-object-cloud-storage"><span class="header-section-number">1.2</span> Evaluation of object cloud storage</a></li>
  <li><a href="#real-world-use-cases" id="toc-real-world-use-cases" class="nav-link" data-scroll-target="#real-world-use-cases"><span class="header-section-number">1.3</span> Real-world Use Cases</a></li>
  <li><a href="#key-advantages-summaries" id="toc-key-advantages-summaries" class="nav-link" data-scroll-target="#key-advantages-summaries"><span class="header-section-number">1.4</span> Key Advantages summaries</a></li>
  <li><a href="#so-then-when-to-use-it" id="toc-so-then-when-to-use-it" class="nav-link" data-scroll-target="#so-then-when-to-use-it"><span class="header-section-number">1.5</span> So then, when to Use It?</a></li>
  </ul></li>
  <li><a href="#object-storage-real-world-vs-minio-simulation" id="toc-object-storage-real-world-vs-minio-simulation" class="nav-link" data-scroll-target="#object-storage-real-world-vs-minio-simulation"><span class="header-section-number">2</span> Object Storage: Real-World vs MinIO Simulation</a>
  <ul class="collapse">
  <li><a href="#real-world-object-storage-on-aws" id="toc-real-world-object-storage-on-aws" class="nav-link" data-scroll-target="#real-world-object-storage-on-aws"><span class="header-section-number">2.1</span> Real-World Object Storage on AWS</a></li>
  <li><a href="#minio-as-a-simulation-of-real-world-object-storage" id="toc-minio-as-a-simulation-of-real-world-object-storage" class="nav-link" data-scroll-target="#minio-as-a-simulation-of-real-world-object-storage"><span class="header-section-number">2.2</span> MinIO as a Simulation of Real-World Object Storage</a></li>
  <li><a href="#docker-setup-for-minio-simulation" id="toc-docker-setup-for-minio-simulation" class="nav-link" data-scroll-target="#docker-setup-for-minio-simulation"><span class="header-section-number">2.3</span> Docker Setup for MinIO Simulation</a></li>
  </ul></li>
  <li><a href="#pipeline-structure" id="toc-pipeline-structure" class="nav-link" data-scroll-target="#pipeline-structure"><span class="header-section-number">3</span> Pipeline structure</a>
  <ul class="collapse">
  <li><a href="#data-generation-frontend-backend" id="toc-data-generation-frontend-backend" class="nav-link" data-scroll-target="#data-generation-frontend-backend"><span class="header-section-number">3.1</span> Data Generation ‚Äì <em>Frontend &amp; Backend</em></a></li>
  <li><a href="#ingestion-from-events-to-storage" id="toc-ingestion-from-events-to-storage" class="nav-link" data-scroll-target="#ingestion-from-events-to-storage"><span class="header-section-number">3.2</span> Ingestion ‚Äì <em>From Events to Storage</em></a></li>
  <li><a href="#storage-distributed-object-storage" id="toc-storage-distributed-object-storage" class="nav-link" data-scroll-target="#storage-distributed-object-storage"><span class="header-section-number">3.3</span> Storage ‚Äì <em>Distributed Object Storage</em></a></li>
  <li><a href="#processing-spark-based-analytics" id="toc-processing-spark-based-analytics" class="nav-link" data-scroll-target="#processing-spark-based-analytics"><span class="header-section-number">3.4</span> Processing ‚Äì <em>Spark-Based Analytics</em></a></li>
  <li><a href="#orchestration-automation-with-airflow" id="toc-orchestration-automation-with-airflow" class="nav-link" data-scroll-target="#orchestration-automation-with-airflow"><span class="header-section-number">3.5</span> Orchestration ‚Äì <em>Automation with Airflow</em></a></li>
  <li><a href="#final-goals" id="toc-final-goals" class="nav-link" data-scroll-target="#final-goals"><span class="header-section-number">3.6</span> üéØ Final Goals</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Engineering Manual</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ettore Miglioranza </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="object-storage" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Object Storage</h1>
<section id="what-is-object-storage" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="what-is-object-storage"><span class="header-section-number">1.1</span> What is Object Storage?</h2>
<p>Object Storage is a way of storing and managing large amounts of unstructured data. Each <strong>object</strong> contains:</p>
<ul>
<li>The data (actual content)</li>
<li>Metadata</li>
<li>A unique identifier</li>
<li>Attributes about the object itself</li>
</ul>
<p>In the world of object storage, all data is stored as objects inside containers called buckets. Notably, these buckets are virtually limitless in size, capable of scaling to hold billions of objects without performance degradation.</p>
<p>Another key feature is that buckets can be used for cold storage‚Äîthat is, to store data that may rarely be accessed but must never be deleted. Users interact with buckets indirectly through APIs, rather than accessing them directly. When a user uploads an object via an API, the system accepts the object and places it into a designated bucket.</p>
<p>While the bucket is a logical (virtual) construct, the object storage system handles the physical storage behind the scenes. For example, it might replicate the object across three separate physical devices. This replication strategy ensures both data integrity and data durability, protecting against hardware failure and data loss.</p>
<p>The <strong>logical bucket</strong>: Exists in the control plane, meaning it‚Äôs about how data is managed, not where it physically lives.</p>
<p><strong>Physical Buckets</strong> (or <strong>Storage Nodes</strong>): is the actual physical storage where the data is written‚Äîlike hard drives, SSDs, or other hardware across data centers. Invisible to the user, objects are often replicated across multiple physical locations for durability and availability, and managed by the storage system, which handles where and how data is stored behind the scenes.</p>
</section>
<section id="evaluation-of-object-cloud-storage" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="evaluation-of-object-cloud-storage"><span class="header-section-number">1.2</span> Evaluation of object cloud storage</h2>
<p>A key concept in object storage is response time. The higher the performance you require‚Äîmeaning the faster the response time‚Äîthe higher the cost. At the lowest cost tier, known as cold storage, data is stored with the assumption that it will rarely, if ever, be accessed. On the other end of the spectrum, storing frequently accessed data‚Äîsuch as images, videos, or other assets served by a website‚Äîfalls into coldish storage (<em>IBM technology definition</em>), which is more expensive due to the higher performance requirements.</p>
<p>In both cases, users interact with the system through APIs, and don‚Äôt need to manage the backend infrastructure. For front-end developers, this abstraction allows them to focus on building interfaces while relying on the object storage platform to handle scalability, durability, and distribution.</p>
</section>
<section id="real-world-use-cases" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="real-world-use-cases"><span class="header-section-number">1.3</span> Real-world Use Cases</h2>
<ul>
<li><p><strong>Video Streaming</strong>: When hosting videos for global streaming, performance and low latency are critical. Instead of storing the object in just three devices, the system replicates the video across multiple geographic locations‚Äîfor example, three different data centers in seven countries. This global replication reduces latency and improves the user experience.</p></li>
<li><p><strong>File Sharing and Collaboration</strong>: Consider a company with a global workforce collaborating on spreadsheets or presentations. Object storage supports versioning, allowing multiple users to work on the same file.</p></li>
</ul>
<p>User1 updates a document in London -&gt; User2 downloads it, makes changes, and reuploads a new version -&gt; User3 in Singapore does the same.</p>
<p>Each modification updates the object‚Äôs metadata, which tracks versions and changes, enabling seamless collaboration without emailing files back and forth. This approach is more efficient, more secure, and easier to control through access permissions.</p>
<ul>
<li><strong>Archival Projects</strong>: For long-term archival, such as storing historical photographs for public access, object storage is ideal. The ‚Äúwrite once, read many‚Äù pattern fits perfectly, as the data is rarely modified but must remain available and secure over time.</li>
</ul>
<p>Common Object Storage services include:</p>
<ul>
<li><strong>Amazon S3</strong></li>
<li><strong>Google Cloud Storage</strong></li>
<li><strong>Azure Blob Storage</strong></li>
</ul>
</section>
<section id="key-advantages-summaries" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="key-advantages-summaries"><span class="header-section-number">1.4</span> Key Advantages summaries</h2>
<ul>
<li>Virtually unlimited scalability<br>
</li>
<li>Cost-efficient<br>
</li>
<li>Accessible via REST APIs<br>
</li>
<li>Ideal for data lakes, backups, and archiving</li>
</ul>
</section>
<section id="so-then-when-to-use-it" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="so-then-when-to-use-it"><span class="header-section-number">1.5</span> So then, when to Use It?</h2>
<p>Object Storage is ideal for:</p>
<ul>
<li>Storing raw data</li>
<li>Saving logs, images, and videos</li>
<li>Integrating with Big Data tools (e.g., Spark, Presto)</li>
</ul>
</section>
</section>
<section id="object-storage-real-world-vs-minio-simulation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Object Storage: Real-World vs MinIO Simulation</h1>
<p>In this project, we use <strong>MinIO</strong> as our object storage solution because it is lightweight, high-performance, and fully compatible with the Amazon S3 API. It allows us to simulate a production-grade object storage environment <strong>locally or on-premises</strong> with full control over replication, versioning, and access policies.</p>
<p>We run MinIO inside a <strong>Docker container</strong> to ensure an isolated, portable, and easy-to-deploy setup. Docker simplifies infrastructure management and allows us to spin up or reset environments quickly during development.</p>
<p>To interact with MinIO from our Python application, we use <strong>Boto3</strong>, the official AWS SDK for Python. Even though it‚Äôs designed for Amazon S3, Boto3 works seamlessly with MinIO thanks to its S3-compatible API. This allows us to perform actions like uploading, downloading, or listing files programmatically without dealing with low-level storage operations.</p>
<section id="real-world-object-storage-on-aws" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="real-world-object-storage-on-aws"><span class="header-section-number">2.1</span> Real-World Object Storage on AWS</h2>
<p>In the real-world, cloud providers like AWS S3 use <strong>object storage</strong> to store data as objects (files) within <strong>buckets</strong>. Each object is composed of data and metadata, and is assigned a unique <strong>key</strong> to access it. These objects are often <strong>split into chunks</strong> for efficient storage and retrieval. Cloud systems, such as AWS S3, store these chunks across <strong>multiple physical devices</strong> or <strong>data centers</strong> in <strong>distributed systems</strong> to ensure <strong>high availability</strong> and <strong>fault tolerance</strong>. The objects are typically replicated to multiple <strong>data centers</strong> or <strong>availability zones</strong> to provide <strong>redundancy</strong> in case of hardware failure or network issues. This replication ensures that if one data center fails, the object is still accessible from another replica in a different data center, providing seamless availability and durability. The object storage system can scale horizontally, meaning the data can be spread across multiple devices to increase storage capacity and system resilience.</p>
</section>
<section id="minio-as-a-simulation-of-real-world-object-storage" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="minio-as-a-simulation-of-real-world-object-storage"><span class="header-section-number">2.2</span> MinIO as a Simulation of Real-World Object Storage</h2>
<p>MinIO is an <strong>open-source, high-performance object storage system</strong> that is <strong>fully compatible</strong> with the AWS S3 API. While AWS S3 operates in a <strong>distributed, multi-node cloud environment</strong>, MinIO allows you to simulate a similar environment on a <strong>single physical node</strong> (your local machine). In MinIO, objects are stored within <strong>buckets</strong>, and large objects can be <strong>split into chunks</strong> for efficient storage. However, unlike AWS S3, MinIO on a local machine operates as a <strong>single-node system</strong>, meaning all data (objects and chunks) are stored on your local storage device, without distribution across multiple devices or data centers. MinIO is a good <strong>simulation of the real-world S3</strong> because it mimics the S3 API, meaning tools like <code>boto3</code> (used to interact with AWS S3) work seamlessly with MinIO, and the overall logic of uploading, storing, and retrieving objects is the same.</p>
</section>
<section id="docker-setup-for-minio-simulation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="docker-setup-for-minio-simulation"><span class="header-section-number">2.3</span> Docker Setup for MinIO Simulation</h2>
<p>To simulate a real-world object storage system on our local machine using MinIO, we set up a <strong>Docker container</strong> to run MinIO as a <strong>single-node object storage service</strong>. The MinIO container is like a logical node in our object storage system, where it interacts with the physical storage devices (like hard drives) to store and retrieve objects. Using <strong>Docker Compose</strong>, we configured MinIO to run locally, with a <strong>bucket</strong> (<code>raw-data</code>) where objects like <code>customers.csv</code> are stored. The bucket is physically stored on the local machine in the <code>./minio_data/</code> directory, simulating how objects would be stored in a real-world cloud environment. This local setup gives us a <strong>single-node system</strong>, where all data (objects and chunks) are stored on one machine, simulating a cloud storage environment without the complexity of a multi-node system. By using Docker, we are able to simulate the behavior of cloud storage systems, like AWS S3, in a contained, isolated environment, which makes it ideal for testing and development without needing cloud resources.</p>
<div class="callout callout-style-default callout-important callout-titled" title="MinIO Bucket Features">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
MinIO Bucket Features
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p><strong>Buckets</strong>: MinIO uses buckets to organize objects. A bucket is similar to a folder or directory in a filesystem, where each bucket can hold an arbitrary number of objects.</p></li>
<li><p><strong>Versioning</strong>: Allows you to keep multiple versions of the same object under the same key.</p></li>
<li><p><strong>Object Locking</strong>: Prevents objects from being deleted. Required to support retention and legal hold. Can only be enabled at bucket creation.</p></li>
<li><p><strong>Quota</strong>: Limits the amount of data in the bucket.</p></li>
<li><p><strong>Retention</strong>: Imposes rules to prevent object deletion for a defined period of time. Versioning must be enabled in order to set bucket retention policies.</p></li>
</ul>
</div>
</div>
<hr>
</section>
</section>
<section id="pipeline-structure" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Pipeline structure</h1>
<p>A typical modern data pipeline, especially in the context of e-commerce, involves several coordinated components working together to ensure consistent data ingestion, storage, processing, and orchestration.</p>
<hr>
<section id="data-generation-frontend-backend" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="data-generation-frontend-backend"><span class="header-section-number">3.1</span> Data Generation ‚Äì <em>Frontend &amp; Backend</em></h2>
<ul>
<li>The website or mobile app (<strong>frontend</strong>) generates events such as clicks, views, and cart additions.</li>
<li>The <strong>backend</strong> handles order processing, user accounts, payments, and logistics.</li>
<li>These data points are tracked and collected in real-time or near-real-time.</li>
<li>Technologies: API endpoints, SDKs, webhooks, system logs, event collectors.</li>
</ul>
<hr>
</section>
<section id="ingestion-from-events-to-storage" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ingestion-from-events-to-storage"><span class="header-section-number">3.2</span> Ingestion ‚Äì <em>From Events to Storage</em></h2>
<ul>
<li>The data is ingested into a centralized system via:
<ul>
<li><strong>Real-time ingestion</strong> (e.g., Kafka, AWS Kinesis, GCP Pub/Sub)</li>
<li><strong>Batch ingestion</strong> (e.g., daily Python scripts, SQL jobs, ETL tools)</li>
</ul></li>
<li>Sources may include:
<ul>
<li>Relational databases</li>
<li>Event streams</li>
<li>File uploads</li>
</ul></li>
</ul>
<hr>
</section>
<section id="storage-distributed-object-storage" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="storage-distributed-object-storage"><span class="header-section-number">3.3</span> Storage ‚Äì <em>Distributed Object Storage</em></h2>
<ul>
<li>Raw data lands in an object storage system such as:
<ul>
<li>Amazon S3</li>
<li>Google Cloud Storage</li>
<li>Azure Blob Storage</li>
<li>MinIO (for local/testing environments)</li>
</ul></li>
<li>Object storage ensures:
<ul>
<li><strong>Scalability</strong> (can handle large volumes)</li>
<li><strong>Durability and availability</strong> (reliable long-term storage)</li>
<li><strong>Flexible formats</strong> (e.g., Parquet, CSV, JSON)</li>
</ul></li>
</ul>
<hr>
</section>
<section id="processing-spark-based-analytics" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="processing-spark-based-analytics"><span class="header-section-number">3.4</span> Processing ‚Äì <em>Spark-Based Analytics</em></h2>
<ul>
<li>A distributed processing engine (typically <strong>Apache Spark</strong>) reads data from storage and performs:
<ul>
<li>Data cleaning</li>
<li>Transformations</li>
<li>Aggregations</li>
<li>Metric calculations</li>
</ul></li>
<li>The output may be:
<ul>
<li>Stored in analytical databases (e.g., BigQuery, Redshift, Snowflake)</li>
<li>Used in BI dashboards</li>
<li>Exported as new processed files</li>
</ul></li>
</ul>
<hr>
</section>
<section id="orchestration-automation-with-airflow" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="orchestration-automation-with-airflow"><span class="header-section-number">3.5</span> Orchestration ‚Äì <em>Automation with Airflow</em></h2>
<ul>
<li>All stages are scheduled and orchestrated with tools like:
<ul>
<li>Apache Airflow</li>
<li>Dagster</li>
<li>Prefect</li>
</ul></li>
<li>These tools handle:
<ul>
<li>Task dependencies</li>
<li>Execution schedules</li>
<li>Error handling and retries</li>
<li>Logging and monitoring</li>
</ul></li>
</ul>
<hr>
</section>
<section id="final-goals" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="final-goals"><span class="header-section-number">3.6</span> üéØ Final Goals</h2>
<ul>
<li><strong>Business insights</strong>: Understand user behavior and site performance.</li>
<li><strong>Machine learning</strong>: Feed models for recommendations, forecasts, etc.</li>
<li><strong>Monitoring &amp; auditing</strong>: Track transactions and operations.</li>
<li><strong>Optimization</strong>: Improve UX, conversion rates, and operations.</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>